{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}Financial Dashboard - Nora Dental Clinic{% endblock %}

{% block page_title %}
    <i class="fas fa-chart-line"></i> Financial Dashboard
{% endblock %}

{% block nav_items %}
    <a href="{% url 'financial_dashboard' %}" class="nav-link flex items-center gap-3 px-4 py-3 transition active">
        <i class="fas fa-home"></i> <span>Dashboard</span>
    </a>
    <div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase mt-3">Revenue</div>
    <a href="{% url 'income_statement' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-chart-bar"></i> <span>Revenue Analysis</span>
    </a>
    <a href="{% url 'income_statement' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-file-invoice-dollar"></i> <span>Income Statement</span>
    </a>
    <div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase mt-3">Departments</div>
    <a href="{% url 'department_financial_report' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-building"></i> <span>Department Reports</span>
    </a>
    <a href="{% url 'doctor_financial_report' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-user-md"></i> <span>Doctor Reports</span>
    </a>
    <a href="{% url 'insurance_report' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-shield-alt"></i> <span>Insurance Reports</span>
    </a>
    <div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase mt-3">Expenses</div>
    <a href="{% url 'expense_list' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-receipt"></i> <span>Expenses</span>
    </a>
    <a href="{% url 'purchase_list' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-shopping-cart"></i> <span>Purchases</span>
    </a>
    <div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase mt-3">Financial Statements</div>
    <a href="{% url 'profit_loss_statement' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-chart-pie"></i> <span>Profit & Loss</span>
    </a>
    <a href="{% url 'balance_sheet' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-balance-scale"></i> <span>Balance Sheet</span>
    </a>
    <div class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase mt-3">Inventory</div>
    <a href="{% url 'inventory_dashboard' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-boxes"></i> <span>Stock Management</span>
    </a>
    <a href="{% url 'stock_alert_list' %}" class="nav-link flex items-center gap-3 px-4 py-2 transition text-sm">
        <i class="fas fa-exclamation-triangle"></i> <span>Stock Alerts</span>
    </a>
{% endblock %}

{% block dashboard_content %}
    <div class="page-subtitle">Financial overview and revenue analysis</div>

    <!-- Statistics Cards -->
    <div class="stats-row">
        <div class="stat-card success">
            <div class="stat-value">{{ total_revenue }}</div>
            <div class="stat-label">Total Revenue (RWF)</div>
        </div>
        <div class="stat-card info">
            <div class="stat-value">{{ paid_amount }}</div>
            <div class="stat-label">Paid (RWF)</div>
        </div>
        <div class="stat-card warning">
            <div class="stat-value">{{ outstanding_amount }}</div>
            <div class="stat-label">Outstanding (RWF)</div>
        </div>
        <div class="stat-card danger">
            <div class="stat-value">{{ pending_invoices_count }}</div>
            <div class="stat-label">Pending Invoices</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px;">
        <!-- Revenue by Department -->
        <div class="table-container">
            <h3 class="table-title">
                <i class="fas fa-building"></i> Revenue by Department
            </h3>
            <table>
                <thead>
                    <tr>
                        <th>Department</th>
                        <th>Visits</th>
                        <th>Revenue</th>
                        <th>Paid</th>
                        <th>Outstanding</th>
                    </tr>
                </thead>
                <tbody>
                    {% for dept in department_revenue %}
                        <tr>
                            <td><strong>{{ dept.name }}</strong></td>
                            <td>{{ dept.visit_count }}</td>
                            <td>{{ dept.total_revenue }} RWF</td>
                            <td>{{ dept.paid_amount }} RWF</td>
                            <td>{{ dept.outstanding }} RWF</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" style="text-align: center; color: #999;">No data</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Insurance vs Private -->
        <div class="table-container">
            <h3 class="table-title">
                <i class="fas fa-heart-pulse"></i> Insurance vs Private
            </h3>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Count</th>
                        <th>Revenue</th>
                        <th>Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Insurance</strong></td>
                        <td>{{ insurance_count }}</td>
                        <td>{{ insurance_revenue }} RWF</td>
                        <td>{{ insurance_percentage }}%</td>
                    </tr>
                    <tr>
                        <td><strong>Private</strong></td>
                        <td>{{ private_count }}</td>
                        <td>{{ private_revenue }} RWF</td>
                        <td>{{ private_percentage }}%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Revenue Trend -->
    <div class="table-container" style="margin-top: 30px;">
        <h3 class="table-title">
            <i class="fas fa-chart-line"></i> Revenue by Doctor
        </h3>
        <table>
            <thead>
                <tr>
                    <th>Doctor Name</th>
                    <th>Department</th>
                    <th>Visits</th>
                    <th>Total Revenue</th>
                    <th>Avg per Visit</th>
                </tr>
            </thead>
            <tbody>
                {% for doctor in doctor_revenue %}
                    <tr>
                        <td><strong>{{ doctor.name }}</strong></td>
                        <td>{{ doctor.department }}</td>
                        <td>{{ doctor.visit_count }}</td>
                        <td>{{ doctor.total_revenue }} RWF</td>
                        <td>{{ doctor.avg_per_visit }} RWF</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: #999;">No data</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Quick Actions -->
    <div class="table-container" style="margin-top: 30px;">
        <h3 class="table-title">
            <i class="fas fa-bolt"></i> Quick Actions
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <button class="btn btn-primary" onclick="departmentReport()" style="width: 100%; padding: 15px;">
                <i class="fas fa-building"></i> Department Report
            </button>
            <button class="btn btn-primary" onclick="doctorReport()" style="width: 100%; padding: 15px;">
                <i class="fas fa-stethoscope"></i> Doctor Report
            </button>
            <button class="btn btn-primary" onclick="insuranceReport()" style="width: 100%; padding: 15px;">
                <i class="fas fa-heart-pulse"></i> Insurance Report
            </button>
            <button class="btn btn-primary" onclick="exportReport()" style="width: 100%; padding: 15px;">
                <i class="fas fa-download"></i> Export Report
            </button>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
function departmentReport() {
    window.location.href = "{% url 'financial_department_report' %}";
}

function doctorReport() {
    window.location.href = "{% url 'financial_doctor_report' %}";
}

function insuranceReport() {
    window.location.href = "{% url 'financial_insurance_report' %}";
}

function exportReport() {
    alert('Export Report feature coming soon');
}
</script>
{% endblock %}
